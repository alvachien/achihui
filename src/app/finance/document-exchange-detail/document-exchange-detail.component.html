<mat-card>
  <mat-card-header>
    <mat-card-title>{{'Finance.CurrencyExchange' | translate}}</mat-card-title>
    <mat-card-subtitle>{{currentMode | translate}}</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <mat-horizontal-stepper linear="false">
      <mat-step>
        <ng-template matStepLabel>{{'Finance.Header' | translate}}</ng-template>

        <!-- Tran date -->
        <mat-form-field class="demo-full-width">
          <input matInput [(ngModel)]="detailObject.TranDate" [matDatepicker]="tdpicker" placeholder="{{'Common.Date' | translate}}">
          <mat-datepicker-toggle matSuffix [for]="tdpicker"></mat-datepicker-toggle>
          <mat-datepicker #tdpicker></mat-datepicker>
        </mat-form-field>

        <!-- Desp -->
        <mat-form-field class="demo-full-width">
          <input matInput type="text" placeholder="{{'Common.Description' | translate}}" [readonly]="!isFieldChangable" [(ngModel)]="detailObject.Desp"
            name="hdrdesp">
        </mat-form-field>

        <div>
          <button mat-button matStepperNext>{{'Common.NextButton' | translate}}</button>
        </div>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>{{'Finance.TransferFrom' | translate}}</ng-template>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Account' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.SourceAccountId"
            name="srcacnt">
            <mat-option *ngFor="let acnt of _storageService.Accounts" [value]="acnt.Id">
              {{acnt.Name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Currency' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.SourceTranCurr"
            name="srccur">
            <mat-option *ngFor="let cr of _currService.Currencies" [value]="cr.Currency">
              {{cr.Symbol}} - {{cr.Name | translate}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width" *ngIf="isForeignSourceCurrency">
          <input matInput type="text" placeholder="{{'Finance.ExchangeRate' |translate}}" matTooltip="{{'Finance.ExchangeRateHint' | translate}}" [readonly]="!isFieldChangable" [(ngModel)]="detailObject.SourceExchangeRate"
            name="hexrate">
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <input matInput type="number" required placeholder="{{'Finance.Amount' | translate}}" [readonly]="!isFieldChangable" [(ngModel)]="detailObject.SourceTranAmount"
            name="srcamt">
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.ControlCenter' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.SourceControlCenterId"
            name="srccc">
            <mat-option *ngFor="let cc of _storageService.ControlCenters" [value]="cc.Id">
              {{cc.Name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Order' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.SourceOrderId"
            name="srcord">
            <mat-option *ngFor="let ord of _storageService.Orders" [value]="ord.Id">
              {{ord.Name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div>
          <button mat-button matStepperPrevious>{{'Common.BackButton' | translate}}</button>
          <button mat-button matStepperNext>{{'Common.NextButton' | translate}}</button>
        </div>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>{{'Finance.TransferTo' | translate}}</ng-template>
        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Account' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.TargetAccountId"
            name="tgtacnt">
            <mat-option *ngFor="let acnt of arUIAccount" [value]="acnt.Id">
              <span [class.expenseaccount]="!acnt.AssetFlag">{{acnt.Name}} ({{acnt.CategoryName}})</span>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Currency' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.TargetTranCurr"
            name="tgtcur">
            <mat-option *ngFor="let cr of _currService.Currencies" [value]="cr.Currency">
              {{cr.Symbol}} - {{cr.Name | translate}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width" *ngIf="isForeignTargetCurrency">
          <input matInput type="text" placeholder="{{'Finance.ExchangeRate' |translate}}" matTooltip="{{'Finance.ExchangeRateHint' | translate}}" [readonly]="!isFieldChangable" [(ngModel)]="detailObject.TargetExchangeRate"
            name="hexrate">
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <input matInput type="number" required placeholder="{{'Finance.Amount' | translate}}" [readonly]="!isFieldChangable" [(ngModel)]="detailObject.TargetTranAmount"
            name="tgtamt">
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.ControlCenter' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.TargetControlCenterId" name="tgtcc">
            <mat-option>{{'Common.ResetCurrentSelection' | translate}}</mat-option>
            <mat-option *ngFor="let cc of _storageService.ControlCenters" [value]="cc.Id">
              {{cc.Name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="demo-full-width">
          <mat-select placeholder="{{'Finance.Order' | translate}}" [disabled]="!isFieldChangable" [(ngModel)]="detailObject.TargetOrderId" name="tgtord">
            <mat-option>{{'Common.ResetCurrentSelection' | translate}}</mat-option>
            <mat-option *ngFor="let tt of arUIOrder" [value]="tt.Id">
              {{tt.Name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <div>
          <button mat-button matStepperPrevious>{{'Common.BackButton' | translate}}</button>
          <button mat-button matStepperNext>{{'Common.NextButton' | translate}}</button>
        </div>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>{{'Finance.PreviousDocWithPlannedExgRate' | translate}}</ng-template>
        <table class="table table-responsive table-bordered table-striped">
          <tr>
            <th></th>
            <th>#</th>
            <th>{{'Common.Type' | translate}}</th>
            <th>{{'Common.Date' | translate}}</th>
            <th>{{'Common.Description' | translate}}</th>
            <th>{{'Finance.Currency' | translate}}</th>
            <th>{{'Finance.ExchangeRate' | translate}}</th>
            <th>{{'Finance.ProposedExchangeRate' | translate}}</th>
            <th>{{'Finance.Currency' | translate}}</th>
            <th>{{'Finance.ExchangeRate' | translate}}</th>
            <th>{{'Finance.ProposedExchangeRate' | translate}}</th>
          </tr>

          <tr *ngFor="let doc of detailObject.prvdocs">
            <td>
              <mat-checkbox [(ngModel)]="doc.Selected"></mat-checkbox>
            </td>
            <td>{{doc.DocID}}</td>
            <td>{{doc.DocType}}</td>
            <td>{{doc.TranDateDisplayString}}</td>
            <td>{{doc.Desp}}</td>
            <td>{{doc.TranCurr}}</td>
            <td>{{doc.ExgRate}}</td>
            <td>
              <mat-checkbox disabled [(ngModel)]="doc.ExgRate_Plan"></mat-checkbox>
            </td>
            <td>{{doc.TranCurr2}}</td>
            <td>{{doc.ExgRate2}}</td>
            <td>
              <mat-checkbox disabled [(ngModel)]="doc.ExgRate_Plan2"></mat-checkbox>
            </td>
          </tr>
        </table>
        <div>
          <button mat-button [disabled]="!isFieldChangable" (click)="onFetchPreviousDoc()">{{'Common.Refresh' | translate}}</button>
          <button mat-button matStepperPrevious>{{'Common.BackButton' | translate}}</button>
          <button mat-button matStepperNext>{{'Common.NextButton' | translate}}</button>
        </div>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>{{'Common.ReviewForSubmit' | translate}}</ng-template>
          <p> 
            {{detailObject.SourceAccountId}} ... {{detailObject.TargetAccountId}}
          </p>  
        <div>
          <button mat-button matStepperPrevious>{{'Common.BackButton' | translate}}</button>
          <button mat-button color="primary" *ngIf="isFieldChangable" [disabled]="!canSubmit()" (click)="onSubmit()">{{'Common.Submit' | translate}}</button>
          <button mat-button (click)="onCancel()">{{'Common.Cancel' | translate}}</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-card-content>
</mat-card>
