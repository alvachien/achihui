<nz-page-header nzBackIcon>
  <nz-breadcrumb nz-page-header-breadcrumb>
    <nz-breadcrumb-item><a routerLink="/finance/overview">{{'Common.Overview' | transloco}}</a></nz-breadcrumb-item>
  </nz-breadcrumb>
  <nz-page-header-title>{{'Common.Overview' | transloco}}</nz-page-header-title>
  <nz-page-header-extra>
    <button *ngIf="!isChildMode" nz-button nzType="text" (click)="onAssetDeprec()">{{'Sys.DocTy.AssetDeprec' | transloco}}</button>
    <nz-switch *ngIf="!isChildMode" [(ngModel)]="excludeTransfer" [nzCheckedChildren]="'Finance.ExcludeTransfer' | transloco" [nzUnCheckedChildren]="'Common.All' | transloco" 
      (ngModelChange)="fetchData(true)"></nz-switch>
  </nz-page-header-extra>
</nz-page-header>

<div *ngIf="isChildMode">
  <article nz-typography>
    <h1 nz-typography>{{'Common.ChildMode' | transloco}}</h1>
    <p nz-typography>{{'Common.ChildModeDetail' | transloco}}</p>
  </article>
</div>

<div *ngIf="!isChildMode">
  <div style="background: #ECECEC; padding: 30px;" *ngIf="keyfigure">
    <nz-row [nzGutter]="16">
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValue]="(keyfigure!.CurrentMonthIncome | number: '1.0-2')!" [nzSuffix]="keyfigure!.BaseCurrency" [nzTitle]="'Finance.IncomeInCurrentMonth' | transloco"></nz-statistic>        
        </nz-card>
      </nz-col>
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValue]="(keyfigure!.CurrentMonthOutgo | number: '1.0-2')!" [nzSuffix]="keyfigure!.BaseCurrency" [nzTitle]="'Finance.OutgoInCurrentMonth' | transloco"></nz-statistic>
        </nz-card>
      </nz-col>
    </nz-row>
  </div>
  <div style="background: #ECECEC; padding: 30px;" *ngIf="keyfigure">
    <nz-row [nzGutter]="16">
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValueTemplate]="valueTpl" [nzValue]="(keyfigure!.CurrentMonthIncomePrecentage | number: '1.0-2')!" [nzTitle]="'Finance.IncomeMonthOnMonthRatio' | transloco"></nz-statistic>
        </nz-card>
      </nz-col>
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValueTemplate]="valueTpl" [nzValue]="(keyfigure!.CurrentMonthOutgoPrecentage | number: '1.0-2')!" [nzTitle]="'Finance.OutgoMonthOnMonthRatio' | transloco"></nz-statistic>
        </nz-card>
      </nz-col>
      <ng-template #valueTpl let-value>
        <span [style.color]="value > 0? '#3F8600' : '#CF1322'">
          <i *ngIf="value < 0" nz-icon nzType="arrow-down"></i>
          <i *ngIf="value > 0" nz-icon nzType="arrow-up"></i>
          <span>{{value}}%</span>
        </span>
      </ng-template>
    </nz-row>
  </div>
  <div style="background: #ECECEC; padding: 30px;" *ngIf="keyfigure">
    <nz-row [nzGutter]="16">
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValue]="(keyfigure!.IncomeYTD | number: '1.0-2')!" [nzSuffix]="keyfigure!.BaseCurrency" [nzTitle]="'Finance.IncomeYTD' | transloco"></nz-statistic>
        </nz-card>
      </nz-col>
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
        <nz-card>
          <nz-statistic [nzValue]="(keyfigure!.OutgoYTD | number: '1.0-2')!" [nzSuffix]="keyfigure!.BaseCurrency" [nzTitle]="'Finance.OutgoYTD' | transloco"></nz-statistic>
        </nz-card>
      </nz-col>
    </nz-row>
  </div>

  <nz-divider></nz-divider>

  <nz-calendar [(ngModel)]="selectedDate" (nzSelectChange)="onSelectChange($event)" (nzPanelChange)="onPanelChange($event)">
    <ul *nzDateCell="let date" class="events">
      <li *ngFor="let item of getDPDocsByDate(date)">
        <div>
          <button nz-button nz-popconfirm [nzPopconfirmTitle]="'Common.OperationConfirmationContent' | transloco"
            (nzOnConfirm)="doPostDPDoc(item)"
            nzShape="circle"><i nz-icon nzType="export"></i></button>
          <span>{{item.Desp}}</span>
        </div>
      </li>
      <li *ngFor="let item of getLoanDocsByDate(date)">
        <div>
          <button nz-button nz-popconfirm [nzPopconfirmTitle]="'Common.OperationConfirmationContent' | transloco"
            (nzOnConfirm)="doPostLoanDoc(item)"><i nz-icon nzType="export"></i></button>
          <span>{{item.Desp}}</span>
        </div>
      </li>
    </ul>
    <ng-container *nzMonthCell="let month">
      <div *ngIf="getMonthData(month) as monthData" class="notes-month">
        <section>{{ monthData }}</section>
      </div>
    </ng-container>
  </nz-calendar>
</div>
